<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Portfolios</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/theme/black.css" id="theme">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  <!-- Add vis.js library -->
  <link rel="stylesheet" href="https://unpkg.com/vis-network/dist/dist/vis-network.min.css">
</head>
<body>
  <div class="reveal">
    <div class="slides">

      <!-- Slide 1: Profile -->
      <section id="profile-section">
        <h3>Portfolios</h3>
        <div class="loading">Loading profiles...</div>
        <div class="profile-grid">
          <!-- Profile cards will be inserted here by JavaScript -->
        </div>
      </section>

      <!-- Slide 2: Skills -->
      <section id="skills-section">
        <h3>Technical Expertise</h3>
        <div class="loading">Loading skills...</div>        
        <div class="tools-frameworks-block">
          <div class="category-header">
            <i class="fas fa-tools category-icon"></i>
            <h3>Tools & Frameworks</h3>
          </div>
          <div id="tools-content" class="skill-content"></div>
        </div>

        <div class="two-column-container">
          <div class="column">
            <div class="category-header">
              <i class="fas fa-code category-icon"></i>
              <h3>Programming Languages</h3>
            </div>
            <div id="languages-content" class="skill-content"></div>
          </div>
          <div class="column">
            <div class="category-header">
              <i class="fas fa-brain category-icon"></i>
              <h3>AI/ML Skills</h3>
            </div>
            <div id="aiml-content" class="skill-content"></div>
          </div>
        </div>
      </section>

      <!-- Slide 3: Projects -->
      <section id="projects-section">
        <h3>Projects</h3>
        <div id="projects-grid" class="projects-grid">
          <!-- Project cards will be dynamically inserted here -->
        </div>
      </section>

      <script>
        document.addEventListener('DOMContentLoaded', function() {
          // Define API URL based on hostname
          const API_URL = window.location.hostname.includes('localhost') 
              ? 'http://localhost:5000'
              : 'https://profile-backend-9kyx.onrender.com';

          // Function to get unique values from comma-separated strings
          function getUniqueProjects(data) {
            const allProjects = data
              .map(item => (item.Projects || '').split(','))
              .flat()
              .map(project => project.trim())
              .filter(project => project !== '');
            return [...new Set(allProjects)].sort();
          }

          // Function to create a project card
          function createProjectCard(projectName) {
            return `
              <div class="project-card detailed">
                <h3 class="project-title">${projectName}</h3>
                <div class="project-content">
                  <h3>Summary</h3>
                  <div class="content-text">
                    Project details for ${projectName}
                  </div>
                </div>
              </div>
            `;
          }

          // Fetch data and create visualizations
          fetch(API_URL + '/get_data')
            .then(response => response.json())
            .then(data => {
              // Get unique projects and create project cards
              const uniqueProjects = getUniqueProjects(data);
              console.log('List of Unique Projects:', uniqueProjects);

              const projectsGrid = document.getElementById('projects-grid');
              uniqueProjects.forEach(project => {
                projectsGrid.innerHTML += createProjectCard(project);
              });

              // Create network visualization
              createNetworkVisualization(data);
            })
            .catch(error => {
              console.error('Error loading data:', error);
              document.getElementById('projects-grid').innerHTML = '<p>Error loading projects</p>';
            });
        });
      </script>

      <!-- Slide 4: K-Partite Graph -->
      <section id="network-section">
        <h3>Skills & Projects Network</h3>
        <div id="network-container">
          <div id="network"></div>
          <div class="network-legend">
            <div class="legend-item"><span class="legend-dot employee"></span>Employees</div>
            <div class="legend-item"><span class="legend-dot project"></span>Projects</div>
          </div>
        </div>
      </section>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.js"></script>
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <script src="server/scripts.js" defer></script>

  <script>
    // Initialize Reveal.js
    Reveal.initialize({
      controls: true,
      progress: true,
      center: false,
      hash: true,
      transition: 'slide',
      width: "100%",
      height: "100%",
      margin: 0,
      minScale: 0.8,
      maxScale: 1,
      plugins: [],
      slideNumber: true,
      overview: true,
      touch: true,
      fragments: true,
      embedded: false,
      help: true,
      showNotes: false,
      autoPlayMedia: false,
      autoSlide: 0
    });

    // Network options
    const networkOptions = {
      nodes: {
        font: { 
          size: 10,
          color: '#f8fafc',
          face: 'Inter'
        },
        borderWidth: 1,
        shadow: true
      },
      edges: {
        width: 1.5,
        color: { color: '#2563eb', opacity: 0.6 },
        smooth: {
          type: 'cubicBezier'
        }
      }
    };

    // Update createNetworkVisualization to use the network options
    function createNetworkVisualization(data) {
      const container = document.getElementById('network');
      if (!container) return;

      let nodeId = 1;
      const nodes = [];
      const edges = [];
      const nodeMap = new Map();

      // Add person nodes
      data.forEach(person => {
        const personId = nodeId++;
        nodes.push({
          id: personId,
          label: person['Full Name'],
          group: 'person',
          shape: 'circularImage',
          image: 'https://img.icons8.com/color/96/000000/user-male-circle--v1.png'
        });

        // Add project nodes and edges
        const projects = (person.Projects || '').split(',').map(p => p.trim()).filter(p => p);
        projects.forEach(project => {
          let projectId = nodeMap.get(project);
          if (!projectId) {
            projectId = nodeId++;
            nodeMap.set(project, projectId);
            nodes.push({ id: projectId, label: project, group: 'project' });
          }
          edges.push({ from: personId, to: projectId });
        });
      });

      // Create the network
      const networkData = {
        nodes: new vis.DataSet(nodes),
        edges: new vis.DataSet(edges)
      };

      new vis.Network(container, networkData, networkOptions);
    }
  </script>

</body>
</html>
